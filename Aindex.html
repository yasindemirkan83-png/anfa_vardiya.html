<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Görev & Mesaj Sistemi</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:Arial;background:#eceff1;margin:0}
header{background:#263238;color:#fff;padding:12px;text-align:center;font-size:18px}
.card{background:#fff;margin:15px;padding:15px;border-radius:10px;box-shadow:0 3px 8px rgba(0,0,0,.2)}
input,button{width:100%;padding:8px;margin:6px 0;font-size:14px;border-radius:6px;border:1px solid #ccc}
button{background:#2196F3;color:#fff;border:none}
.task{border:1px solid #aaa;border-radius:6px;padding:8px;margin:5px 0}
.msg{background:#f5f5f5;padding:6px;border-radius:5px;margin:4px 0}
</style>
</head>
<body>

<header>Görev & Mesaj Sistemi</header>

<div class="card" id="login">
<h3>Giriş</h3>
<input id="gmail" placeholder="Gmail">
<input id="rumuz" placeholder="Rumuz">
<button onclick="login()">Giriş Yap</button>
</div>

<div class="card" id="app" style="display:none">
<h3>Yeni Görev</h3>
<input type="date" id="tarih">
<input type="time" id="saat">
<input id="baslik" placeholder="Başlık">
<input id="aciklama" placeholder="Açıklama">
<button onclick="gorevEkle()">Görev Kaydet</button>

<hr>
<h3>Mesaj</h3>
<input id="mesajInput" placeholder="Mesaj yaz">
<button onclick="mesajGonder()">Mesaj Gönder</button>

<hr>
<h3>Görevler</h3>
<div id="gorevListe"></div>

<hr>
<h3>Mesajlar</h3>
<div id="mesajListe"></div>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbyxfXsdgam3BzOID_79PoA1eEMrepWl35uVnvNZmVuBkItb5KfeAuB7g8GKZHFNPNg4/exec";

function login(){
  if(!gmail.value || !rumuz.value){
    alert("Boş bırakma"); return;
  }
  localStorage.setItem("gmail", gmail.value);
  localStorage.setItem("rumuz", rumuz.value);
  login.style.display="none";
  app.style.display="block";
  veriGetir();
  setInterval(veriGetir,5000);
}

// GÖREV
function gorevEkle(){
  fetch(API,{
    method:"POST",
    body: JSON.stringify({
      tip:"not",
      tarih: tarih.value,
      saat: saat.value,
      baslik: baslik.value,
      aciklama: aciklama.value,
      kullanici: localStorage.getItem("rumuz")
    })
  }).then(r=>r.json())
  .then(d=>{
    if(d.status=="ok"){
      baslik.value=""; aciklama.value="";
      veriGetir();
    } else alert(d.message);
  });
}

// MESAJ
function mesajGonder(){
  fetch(API,{
    method:"POST",
    body: JSON.stringify({
      tip:"mesaj",
      mesaj: mesajInput.value,
      kullanici: localStorage.getItem("rumuz")
    })
  }).then(r=>r.json())
  .then(d=>{
    mesajInput.value="";
    veriGetir();
  });
}

// VERİ OKU
function veriGetir(){
  fetch(API)
  .then(r=>r.json())
  .then(data=>{
    let gorevHtml="";
    let mesajHtml="";

    data.slice(1).forEach(r=>{
      if(r[0]=="not"){
        gorevHtml += `<div class="task">
          <b>${r[1]} ${r[2]}</b><br>
          ${r[3]}<br>
          ${r[4]}<br>
          <small>${r[5]}</small>
        </div>`;
      }
      if(r[0]=="mesaj"){
        mesajHtml += `<div class="msg">
          <b>${r[5]}</b>: ${r[4]}
        </div>`;
      }
    });

    gorevListe.innerHTML = gorevHtml || "Görev yok";
    mesajListe.innerHTML = mesajHtml || "Mesaj yok";
  });
}
</script>
</body>
</html>
